---
title: "Bat Paper Data Analysis S23"
author: "Adam Bruce"
date: '2023-05-15'
output: html_document
---

```{r, include = FALSE}
library(tidyverse)
library(knitr)
library(dplyr)
library(corrplot)
library(skimr)
library(grid)
library(gridExtra)
library(tidyselect)
library(selectr)
library(ISLR)
library(forcats)
library(corrplot)
library(ggplot2)
library(kableExtra)
library(caret)
library(grid)
library(openintro)
library(tidyverse)
library(ISLR)
library(caret)
library(recipes)
library(glmnet)
library(gam)
library(splines)
library(earth)
library(rpart)
library(rpart.plot)
library(ipred)
library(e1071)
library(ranger)
library(pls)
library(datasets)
library(DescTools) 
library(Hmisc)
library(e1071)
library(pwr)
library(gapminder)
library(car) 
library(tibble)
library(onewaytests) 
library(rptR) 
library(esc) 
library(broom) 
library(MASS) 
library(corrgram) 
library(rcompanion)
library(FSA)
library(lmtest) 
library(lme4)
library(lmerTest)
library(Hmisc)
library(nlme)
library(GGally)
library(factoextra)
library(ISLR) 
library(cluster) # for gower similarity and pam
library(Rtsne)
library(mixtools)
library(mclust)
library(lattice)
require(pscl) # alternatively can use package ZIM for zero-inflated models
library(ggpubr)

COMBINED_DATA <- read_csv("~/Desktop/Wildlife_Ecology/Bat_Paper/BIOL345_BATPAPER_ANALYSIS/BUBOLZ_HECKRODT_COMBINED.csv")

SUMMARIZED_DATA <- read_csv("~/Desktop/Wildlife_Ecology/Bat_Paper/BIOL345_BATPAPER_ANALYSIS/Updated_PondBat_EnvirVars.csv")

COMBINED_DATA <- COMBINED_DATA %>% na.omit()

```


## Summary Data

```{r}

## Combined Activity/Night

COMPLETE_NIGHTLY_SPECIES_ACTIVITY <- COMBINED_DATA %>% group_by(Pond, Species_ID, Night) %>% summarise(Complete_Activity = n())

COMPLETE_NIGHTLY_SPECIES_ACTIVITY

## Combined Activity Overall

COMPLETE_ACTIVITY <- COMBINED_DATA %>% group_by(Species_ID) %>% summarise(Complete_Activity = n())

COMPLETE_ACTIVITY


## Activity/Pond

ACTIVITY_POND <- COMBINED_DATA %>% group_by(Pond) %>% summarise(Complete_Activity = n())

ACTIVITY_POND

## Average Activity/Pond

MEAN_ACTIVITY_POND <- SUMMARIZED_DATA %>% group_by(Pond) %>% summarise(Mean_Activity = mean(N_Activity), sd = sd(N_Activity))

MEAN_ACTIVITY_POND

## Average Richness/Pond

RICHNESS_POND <- SUMMARIZED_DATA %>% group_by(Pond) %>% summarise(Mean_Richness = mean(N_Richness), sd = sd(N_Richness))

RICHNESS_POND

## Complete Richness Pond

RICHNESS_OVERALL <- COMBINED_DATA %>% group_by(Pond) %>% summarise(Overall_Richness = n_unique(Species_ID))

RICHNESS_OVERALL



```
## Investigative Plots

```{r}
## Activity Pond

OVR_AP<-
  ggplot(ACTIVITY_POND , aes(x=Pond, y=Complete_Activity, fill = Pond))+
  geom_bar(stat="identity", color = "black")+
  labs(x= "Pond", y= "Total Bat Activity", title = "A.")+
  scale_fill_manual(values = c("blue", "darkorange",  "darkorchid", "red", "darkgreen", "deeppink",  "bisque2"))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black"))

## Mean Activity Pond

AVG_AP <-
  ggplot(MEAN_ACTIVITY_POND , aes(x=Pond, y=Mean_Activity, fill = Pond))+
  geom_bar(stat="identity", color = "black")+
  labs(x= "Pond", y= "Mean Bat Activity", title = "C.")+
  geom_errorbar(aes(ymin=Mean_Activity, ymax=Mean_Activity+sd), width=.2,
  position=position_dodge(.9))+
  scale_fill_manual(values = c("blue", "darkorange",  "darkorchid", "red", "darkgreen", "deeppink",  "bisque2"))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black"))

## Richness Overall

OVR_RP <-
  ggplot(RICHNESS_OVERALL , aes(x=Pond, y= Overall_Richness, fill = Pond))+
  geom_bar(stat="identity", color = "black")+
  labs(x= "Pond", y= "Overall Bat Richness", title = "B.")+
  scale_fill_manual(values = c("blue", "darkorange",  "darkorchid", "red", "darkgreen", "deeppink",  "bisque2"))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black"))

## Average Richness Pond

AVG_RP <- 
  ggplot(RICHNESS_POND , aes(x=Pond, y=Mean_Richness, fill = Pond))+
  geom_bar(stat="identity", color = "black")+
  labs(x= "Pond", y= "Mean Bat Richness", title = "D")+
  geom_errorbar(aes(ymin=Mean_Richness, ymax=Mean_Richness+sd), width=.2,
  position=position_dodge(.9))+
  scale_fill_manual(values = c("blue", "darkorange",  "darkorchid", "red", "darkgreen", "deeppink",  "bisque2"))+
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
  panel.background = element_blank(), axis.line = element_line(colour = "black"))


grid.arrange(OVR_AP, OVR_RP, AVG_AP, AVG_RP, ncol=2)


####################################



```

## Statistical Tests

```{r}
### Chi-Square Goodness of Fit Test.

# Q: Are the Five individual Bat Species Observed Equally Common in our sample?
# If Proportion of bats is equivalent across our study, we expect Proportion = 1/5
# Null hypothesis (H0): There is no significant difference between the observed and the expected value.
# Alternative hypothesis (Ha): There is a significant difference between the observed and the expected value.

Species_Activity_Vector = c(3012, 42, 1353, 1327, 145)
Proportion_Vector = c(1/5, 1/5, 1/5, 1/5, 1/5)

Bat_Chi_GF = chisq.test(Species_Activity_Vector,p =  Proportion_Vector)

Bat_Chi_GF

# expected Values

Bat_Chi_GF$expected

# P < 2.2 x 10^-16
# Alternative hypothesis (Ha): There is a significant difference between the observed and the expected value. (Not Equally Common)


```


## LME Model

```{r}



```



## In Class Analysis




































